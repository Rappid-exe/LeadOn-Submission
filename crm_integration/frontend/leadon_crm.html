<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadOn CRM - Contacts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .sidebar {
            width: 240px;
            transition: width 0.3s;
        }
        .sidebar.collapsed {
            width: 60px;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .checkbox-custom {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .chat-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
        }
        .chat-panel.open {
            right: 0;
        }
        .chat-messages {
            height: calc(100vh - 200px);
            overflow-y: auto;
        }
        .action-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        .action-btn.primary {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        .action-btn.primary:hover {
            background: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full bg-white border-r border-gray-200 flex flex-col" id="sidebar">
        <!-- Logo -->
        <div class="p-4 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <button onclick="toggleSidebar()" class="text-gray-600 hover:text-gray-900">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <span class="font-bold text-xl sidebar-text">LeadOn</span>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-2">
            <a href="/crm" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-indigo-50 text-indigo-600">
                <i class="fas fa-users w-5"></i>
                <span class="sidebar-text">Contacts</span>
            </a>
            <a href="/crm/companies" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                <i class="fas fa-building w-5"></i>
                <span class="sidebar-text">Companies</span>
            </a>
            <a href="/crm/campaigns" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                <i class="fas fa-bullhorn w-5"></i>
                <span class="sidebar-text">Campaigns</span>
            </a>
            <a href="/crm/integrations" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                <i class="fas fa-plug w-5"></i>
                <span class="sidebar-text">Integrations</span>
            </a>
        </nav>

        <!-- User Profile -->
        <div class="p-4 border-t border-gray-200">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white">
                    <i class="fas fa-user"></i>
                </div>
                <span class="sidebar-text text-sm font-medium">Admin</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-60 transition-all" id="main-content">
        <!-- Top Bar -->
        <div class="bg-white border-b border-gray-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-semibold text-gray-900">Contacts</h1>
                    <span class="text-sm text-gray-500" id="view-subtitle">All Contacts</span>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleChat()" class="action-btn">
                        <i class="fas fa-comment-dots mr-2"></i>AI Search
                    </button>
                    <button onclick="syncContacts()" class="action-btn">
                        <i class="fas fa-sync mr-2"></i>Sync
                    </button>
                    <button onclick="showCreateModal()" class="action-btn primary">
                        <i class="fas fa-plus mr-2"></i>Create Contact
                    </button>
                </div>
            </div>
        </div>

        <!-- Filters & Search -->
        <div class="bg-white border-b border-gray-200 px-6 py-3">
            <div class="flex items-center space-x-4">
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="Search contacts..." 
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        oninput="filterTable()"
                    >
                </div>
                <button class="action-btn" onclick="toggleFilterPanel()">
                    <i class="fas fa-filter mr-2"></i>Filters
                </button>
                <button class="action-btn" onclick="showImportModal()">
                    <i class="fas fa-upload mr-2"></i>Import CSV
                </button>
                <button class="action-btn" onclick="exportAllContacts()">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
                <button class="action-btn" onclick="clearDatabase()" style="color: #dc2626;">
                    <i class="fas fa-trash mr-2"></i>Clear Database
                </button>
            </div>
        </div>

        <!-- Filter Panel (Hidden by default) -->
        <div id="filter-panel" class="hidden bg-white border-b border-gray-200 px-6 py-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Workflow Stage</label>
                    <select id="filter-workflow" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" onchange="applyFilters()">
                        <option value="">All Stages</option>
                        <option value="new">New</option>
                        <option value="connection_sent">Connection Sent</option>
                        <option value="connected">Connected</option>
                        <option value="message_sent">Message Sent</option>
                        <option value="replied">Replied</option>
                        <option value="meeting_scheduled">Meeting Scheduled</option>
                        <option value="qualified">Qualified</option>
                        <option value="disqualified">Disqualified</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                    <input type="text" id="filter-company" placeholder="Filter by company..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" oninput="applyFilters()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                    <input type="text" id="filter-tags" placeholder="Filter by tags..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" oninput="applyFilters()">
                </div>
                <div class="flex items-end">
                    <button onclick="clearFilters()" class="w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                        <i class="fas fa-times mr-2"></i>Clear Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Contacts Table -->
        <div class="p-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <!-- Table Header -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-4 py-3 text-left w-12">
                                    <input type="checkbox" class="checkbox-custom" id="select-all" onchange="toggleSelectAll()">
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Contact Name
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Links
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Job Title
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Company Name
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tags
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Workflow Stage
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Last Action
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Next Action
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Email
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Phone
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Location
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Created
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="contacts-table-body" class="divide-y divide-gray-200">
                            <!-- Contacts will be loaded here -->
                            <tr>
                                <td colspan="13" class="px-4 py-12 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-3 text-gray-300"></i>
                                    <p>No contacts found. Use AI Search to find contacts.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Table Footer / Pagination -->
                <div class="bg-gray-50 px-6 py-3 border-t border-gray-200 flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        <span id="selected-count">0</span> contacts selected
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="action-btn" onclick="previousPage()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="text-sm text-gray-700">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                        <button class="action-btn" onclick="nextPage()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Bar (shown when contacts selected) -->
            <div id="action-bar" class="hidden fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-indigo-600 text-white rounded-lg shadow-lg px-6 py-4 flex items-center space-x-4">
                <span id="action-bar-count">0 selected</span>
                <div class="h-6 w-px bg-indigo-400"></div>
                <button onclick="startCampaign()" class="hover:bg-indigo-700 px-4 py-2 rounded">
                    <i class="fas fa-paper-plane mr-2"></i>Start Campaign
                </button>
                <button onclick="exportSelected()" class="hover:bg-indigo-700 px-4 py-2 rounded">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
                <button onclick="deleteSelected()" class="hover:bg-red-600 px-4 py-2 rounded">
                    <i class="fas fa-trash mr-2"></i>Delete
                </button>
            </div>
        </div>
    </div>

    <!-- AI Chat Panel -->
    <div class="chat-panel" id="chat-panel">
        <div class="h-full flex flex-col">
            <!-- Chat Header -->
            <div class="bg-indigo-600 text-white p-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-robot text-2xl"></i>
                    <div>
                        <h3 class="font-semibold">AI Search Assistant</h3>
                        <p class="text-xs text-indigo-200">Find contacts with natural language</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-white hover:text-indigo-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages flex-1 p-4 space-y-4" id="chat-messages">
                <div class="bg-gray-100 rounded-lg p-4">
                    <p class="text-sm text-gray-700">ðŸ‘‹ Hi! I can help you find contacts. Try asking:</p>
                    <ul class="mt-2 text-sm text-gray-600 space-y-1">
                        <li>â€¢ "Find CTOs at AI companies in San Francisco"</li>
                        <li>â€¢ "Get me VPs of Sales at Series B startups"</li>
                        <li>â€¢ "Find founders in the fintech space"</li>
                    </ul>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex space-x-2">
                    <input 
                        type="text" 
                        id="chat-input"
                        placeholder="Ask me to find contacts..." 
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        onkeypress="if(event.key==='Enter') sendChatMessage()"
                    >
                    <button onclick="sendChatMessage()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="enrich-jobs-chat" class="rounded">
                        <span>Enrich with job postings</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Contact Modal -->
    <div id="create-contact-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">Create New Contact</h2>
                <button onclick="closeCreateModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="create-contact-form" class="p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
                        <input type="text" id="contact-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="contact-email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="contact-phone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title</label>
                        <input type="text" id="contact-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                        <input type="text" id="contact-company" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn URL</label>
                        <input type="url" id="contact-linkedin" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://linkedin.com/in/...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                        <input type="text" id="contact-city" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                        <input type="text" id="contact-country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma-separated)</label>
                        <input type="text" id="contact-tags" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="founder, fintech, qualified">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeCreateModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" id="submit-contact-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                        Create Contact
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import CSV Modal -->
    <div id="import-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-gray-900">Import Contacts from CSV</h2>
                    <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-6">
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-2">CSV Format Requirements:</h3>
                    <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
                        <li><strong>Required:</strong> Name column (can be "Name", "Full Name", "Contact Name", etc.)</li>
                        <li><strong>Optional:</strong> Email, Title, Company, Phone, LinkedIn, City, State, Country, Tags</li>
                        <li>Column headers are case-insensitive and flexible (e.g., "Email" = "email" = "Email Address")</li>
                        <li>Tags should be comma-separated in a single cell</li>
                        <li>Duplicates (by email or LinkedIn URL) will be skipped automatically</li>
                    </ul>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Select CSV File
                    </label>
                    <input
                        type="file"
                        id="csv-file-input"
                        accept=".csv"
                        class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-lg file:border-0
                            file:text-sm file:font-semibold
                            file:bg-indigo-50 file:text-indigo-700
                            hover:file:bg-indigo-100
                            cursor-pointer"
                    >
                </div>

                <div id="import-preview" class="hidden mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-2">Preview:</h3>
                    <div class="bg-gray-50 rounded-lg p-4 text-sm">
                        <p id="preview-text" class="text-gray-600"></p>
                    </div>
                </div>

                <div id="import-results" class="hidden mb-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-green-900 mb-2">Import Results:</h3>
                        <div id="results-text" class="text-sm text-green-700"></div>
                    </div>
                </div>

                <div id="import-errors" class="hidden mb-6">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-red-900 mb-2">Errors:</h3>
                        <div id="errors-text" class="text-sm text-red-700"></div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeImportModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="button" onclick="importCSV()" id="import-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-upload mr-2"></i>Import
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="leadon_crm.js?v=3"></script>
</body>
</html>

